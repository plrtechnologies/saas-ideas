# Architecture Diagrams

## Legal Opinion SaaS Platform

---

## 1. System Context Diagram (C4 Level 1)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                    EXTERNAL ACTORS                                       │
└─────────────────────────────────────────────────────────────────────────────────────────┘

     ┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐
     │   Bank Officer  │       │ Panel Advocate  │       │   Bank Admin    │
     │                 │       │    (Lawyer)     │       │                 │
     │ • Creates loan  │       │ • Reviews docs  │       │ • Manages users │
     │   requests      │       │ • Generates     │       │ • Views reports │
     │ • Uploads docs  │       │   opinions      │       │ • Configures    │
     │ • Tracks status │       │ • Submits for   │       │   workflows     │
     │                 │       │   approval      │       │                 │
     └────────┬────────┘       └────────┬────────┘       └────────┬────────┘
              │                         │                         │
              │                         │                         │
              └─────────────────────────┼─────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                          │
│                        ╔═══════════════════════════════════════╗                        │
│                        ║                                       ║                        │
│                        ║     LEGAL OPINION SAAS PLATFORM       ║                        │
│                        ║                                       ║                        │
│                        ║  • Document Management                ║                        │
│                        ║  • Legal Opinion Workflow             ║                        │
│                        ║  • Multi-tenant Architecture          ║                        │
│                        ║  • User & Access Management           ║                        │
│                        ║  • Audit & Compliance                 ║                        │
│                        ║                                       ║                        │
│                        ╚═══════════════════════════════════════╝                        │
│                                        │                                                 │
└────────────────────────────────────────┼─────────────────────────────────────────────────┘
                                         │
              ┌──────────────────────────┼──────────────────────────┐
              │                          │                          │
              ▼                          ▼                          ▼
     ┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐
     │   Email Service │       │  SMS Gateway    │       │ Bank Core       │
     │   (AWS SES)     │       │  (Optional)     │       │ Systems (Future)│
     │                 │       │                 │       │                 │
     │ Notifications,  │       │ OTP, Alerts     │       │ Loan origination│
     │ Alerts          │       │                 │       │ integration     │
     └─────────────────┘       └─────────────────┘       └─────────────────┘
```

---

## 2. Container Diagram (C4 Level 2)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              LEGAL OPINION SAAS PLATFORM                                 │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                              PRESENTATION LAYER                                     │ │
│  │                                                                                     │ │
│  │    ┌────────────────────────────────────────────────────────────────────────────┐  │ │
│  │    │                         WEB APPLICATION (SPA)                               │  │ │
│  │    │                                                                             │  │ │
│  │    │   React.js | TypeScript | Responsive Design | PWA Support                  │  │ │
│  │    │                                                                             │  │ │
│  │    │   Modules:                                                                  │  │ │
│  │    │   • Authentication & Authorization                                          │  │ │
│  │    │   • Dashboard & Analytics                                                   │  │ │
│  │    │   • Loan Request Management                                                 │  │ │
│  │    │   • Document Upload & Preview                                               │  │ │
│  │    │   • Opinion Editor & Workflow                                               │  │ │
│  │    │   • User & Role Management                                                  │  │ │
│  │    │   • Reports & Audit Logs                                                    │  │ │
│  │    └────────────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                                     │ │
│  └────────────────────────────────────────────────────────────────────────────────────┘ │
│                                           │                                              │
│                                           │ HTTPS / REST API                             │
│                                           ▼                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                 API LAYER                                           │ │
│  │                                                                                     │ │
│  │    ┌────────────────────────────────────────────────────────────────────────────┐  │ │
│  │    │                           API GATEWAY                                       │  │ │
│  │    │                                                                             │  │ │
│  │    │   • Request Routing          • Rate Limiting (per tenant)                   │  │ │
│  │    │   • JWT Validation           • Request Logging                              │  │ │
│  │    │   • Tenant Resolution        • API Versioning                               │  │ │
│  │    └────────────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                                     │ │
│  └────────────────────────────────────────────────────────────────────────────────────┘ │
│                                           │                                              │
│                                           ▼                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                              MICROSERVICES LAYER                                    │ │
│  │                                                                                     │ │
│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │ │
│  │   │    USER      │  │   DOCUMENT   │  │   OPINION    │  │ NOTIFICATION │          │ │
│  │   │   SERVICE    │  │   SERVICE    │  │   SERVICE    │  │   SERVICE    │          │ │
│  │   │              │  │              │  │              │  │              │          │ │
│  │   │ • Auth       │  │ • Upload     │  │ • Create     │  │ • Email      │          │ │
│  │   │ • Users      │  │ • Storage    │  │ • Workflow   │  │ • In-app     │          │ │
│  │   │ • Roles      │  │ • Metadata   │  │ • Templates  │  │ • SMS        │          │ │
│  │   │ • Profiles   │  │ • Scanning   │  │ • PDF Gen    │  │              │          │ │
│  │   └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘          │ │
│  │                                                                                     │ │
│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────────────────────────────┐    │ │
│  │   │    AUDIT     │  │   REPORT     │  │         AI/LLM SERVICE              │    │ │
│  │   │   SERVICE    │  │   SERVICE    │  │                                      │    │ │
│  │   │              │  │              │  │ • Document Intelligence (Extraction) │    │ │
│  │   │ • Logging    │  │ • Analytics  │  │ • Opinion Generation (LLM)          │    │ │
│  │   │ • Compliance │  │ • Dashboards │  │ • Textract Integration (OCR)        │    │ │
│  │   │ • Search     │  │ • Exports    │  │ • Bedrock Integration (Claude)      │    │ │
│  │   └──────────────┘  └──────────────┘  └──────────────────────────────────────┘    │ │
│  │                                                                                     │ │
│  └────────────────────────────────────────────────────────────────────────────────────┘ │
│                                           │                                              │
│                                           ▼                                              │
│  ┌────────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                 DATA LAYER                                          │ │
│  │                                                                                     │ │
│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │ │
│  │   │  PostgreSQL  │  │    Redis     │  │   Amazon     │  │   Amazon     │          │ │
│  │   │   (RDS)      │  │(ElastiCache) │  │     S3       │  │    SQS       │          │ │
│  │   │              │  │              │  │              │  │              │          │ │
│  │   │ • Users      │  │ • Sessions   │  │ • Documents  │  │ • Doc Queue  │          │ │
│  │   │ • Requests   │  │ • Cache      │  │ • PDFs       │  │ • Notify Q   │          │ │
│  │   │ • Opinions   │  │ • Rate Limit │  │ • Thumbnails │  │ • Audit Q    │          │ │
│  │   │ • Audit Logs │  │              │  │              │  │              │          │ │
│  │   └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘          │ │
│  │                                                                                     │ │
│  └────────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. AWS Infrastructure Diagram

```
                                    ┌─────────────────────────────────────┐
                                    │            INTERNET                  │
                                    └──────────────────┬──────────────────┘
                                                       │
                                    ┌──────────────────▼──────────────────┐
                                    │           AWS CLOUD                  │
                                    └──────────────────┬──────────────────┘
                                                       │
                         ┌─────────────────────────────┼─────────────────────────────┐
                         │                             │                             │
                         ▼                             ▼                             ▼
              ┌─────────────────────┐     ┌─────────────────────┐     ┌─────────────────────┐
              │     ROUTE 53        │     │     CLOUDFRONT      │     │       WAF           │
              │     (DNS)           │     │     (CDN)           │     │   (Firewall)        │
              │                     │     │                     │     │                     │
              │ • Domain routing    │     │ • Static content    │     │ • DDoS protection   │
              │ • Health checks     │     │ • Edge caching      │     │ • SQL injection     │
              │ • Failover          │     │ • SSL termination   │     │ • XSS protection    │
              └─────────────────────┘     └─────────────────────┘     └─────────────────────┘
                                                       │
                                    ┌──────────────────▼──────────────────┐
                                    │      APPLICATION LOAD BALANCER       │
                                    │                                      │
                                    │  • HTTPS termination                 │
                                    │  • Path-based routing                │
                                    │  • Health checks                     │
                                    └──────────────────┬──────────────────┘
                                                       │
┌──────────────────────────────────────────────────────┼──────────────────────────────────────────────────────┐
│                                                      │                                                       │
│                                      VPC (10.0.0.0/16) - Region: ap-south-1 (Mumbai)                        │
│                                                      │                                                       │
│   ┌──────────────────────────────────────────────────┼──────────────────────────────────────────────────┐   │
│   │                                                  │                                                   │   │
│   │   PUBLIC SUBNETS                                 │                                                   │   │
│   │   ┌────────────────────────┐     ┌────────────────────────┐                                         │   │
│   │   │  Subnet A (AZ-1a)      │     │  Subnet B (AZ-1b)      │                                         │   │
│   │   │  10.0.1.0/24           │     │  10.0.2.0/24           │                                         │   │
│   │   │                        │     │                        │                                         │   │
│   │   │   ┌──────────────┐     │     │   ┌──────────────┐     │                                         │   │
│   │   │   │  NAT Gateway │     │     │   │  NAT Gateway │     │                                         │   │
│   │   │   └──────────────┘     │     │   └──────────────┘     │                                         │   │
│   │   └────────────────────────┘     └────────────────────────┘                                         │   │
│   │                                                                                                      │   │
│   └──────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                      │                                                       │
│   ┌──────────────────────────────────────────────────┼──────────────────────────────────────────────────┐   │
│   │                                                  │                                                   │   │
│   │   PRIVATE SUBNETS (Application)                  │                                                   │   │
│   │   ┌────────────────────────┐     ┌────────────────────────┐                                         │   │
│   │   │  Subnet A (AZ-1a)      │     │  Subnet B (AZ-1b)      │                                         │   │
│   │   │  10.0.10.0/24          │     │  10.0.20.0/24          │                                         │   │
│   │   │                        │     │                        │                                         │   │
│   │   │  ┌──────────────────────────────────────────────────────────────────────────────────┐           │   │
│   │   │  │                           EKS CLUSTER                                             │           │   │
│   │   │  │                                                                                   │           │   │
│   │   │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │           │   │
│   │   │  │   │ API Gateway │ │User Service │ │ Doc Service │ │Opinion Svc  │               │           │   │
│   │   │  │   │   Pods      │ │   Pods      │ │   Pods      │ │   Pods      │               │           │   │
│   │   │  │   └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘               │           │   │
│   │   │  │                                                                                   │           │   │
│   │   │  │   ┌─────────────┐ ┌─────────────┐ ┌─────────────┐                               │           │   │
│   │   │  │   │Notify Svc   │ │ Audit Svc   │ │ Report Svc  │                               │           │   │
│   │   │  │   │   Pods      │ │   Pods      │ │   Pods      │                               │           │   │
│   │   │  │   └─────────────┘ └─────────────┘ └─────────────┘                               │           │   │
│   │   │  │                                                                                   │           │   │
│   │   │  └───────────────────────────────────────────────────────────────────────────────────┘           │   │
│   │   └────────────────────────┘     └────────────────────────┘                                         │   │
│   │                                                                                                      │   │
│   └──────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                      │                                                       │
│   ┌──────────────────────────────────────────────────┼──────────────────────────────────────────────────┐   │
│   │                                                  │                                                   │   │
│   │   PRIVATE SUBNETS (Data)                         │                                                   │   │
│   │   ┌────────────────────────┐     ┌────────────────────────┐                                         │   │
│   │   │  Subnet A (AZ-1a)      │     │  Subnet B (AZ-1b)      │                                         │   │
│   │   │  10.0.100.0/24         │     │  10.0.200.0/24         │                                         │   │
│   │   │                        │     │                        │                                         │   │
│   │   │   ┌──────────────┐     │     │   ┌──────────────┐     │                                         │   │
│   │   │   │ RDS Primary  │◄────┼─────┼──►│ RDS Standby  │     │                                         │   │
│   │   │   │ PostgreSQL   │     │     │   │ PostgreSQL   │     │                                         │   │
│   │   │   └──────────────┘     │     │   └──────────────┘     │                                         │   │
│   │   │                        │     │                        │                                         │   │
│   │   │   ┌──────────────┐     │     │   ┌──────────────┐     │                                         │   │
│   │   │   │ ElastiCache  │◄────┼─────┼──►│ ElastiCache  │     │                                         │   │
│   │   │   │ Redis Node 1 │     │     │   │ Redis Node 2 │     │                                         │   │
│   │   │   └──────────────┘     │     │   └──────────────┘     │                                         │   │
│   │   └────────────────────────┘     └────────────────────────┘                                         │   │
│   │                                                                                                      │   │
│   └──────────────────────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘


┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                              │
│                                          AWS GLOBAL SERVICES                                                 │
│                                                                                                              │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │
│   │   Amazon     │  │   Amazon     │  │   Amazon     │  │   Secrets    │  │   Amazon     │                 │
│   │     S3       │  │   Cognito    │  │     SES      │  │   Manager    │  │     SQS      │                 │
│   │              │  │              │  │              │  │              │  │              │                 │
│   │ • Documents  │  │ • User Pool  │  │ • Email      │  │ • DB Creds   │  │ • Doc Queue  │                 │
│   │ • PDFs       │  │ • Auth       │  │ • Templates  │  │ • API Keys   │  │ • Notify Q   │                 │
│   │ • Assets     │  │ • MFA        │  │              │  │ • Secrets    │  │ • Audit Q    │                 │
│   └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘                 │
│                                                                                                              │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                 │
│   │  CloudWatch  │  │  CloudTrail  │  │     ECR      │  │     KMS      │  │  GuardDuty   │                 │
│   │              │  │              │  │              │  │              │  │              │                 │
│   │ • Logs       │  │ • API Audit  │  │ • Container  │  │ • Encryption │  │ • Threat     │                 │
│   │ • Metrics    │  │ • Compliance │  │   Images     │  │   Keys       │  │   Detection  │                 │
│   │ • Alarms     │  │              │  │              │  │              │  │              │                 │
│   └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘                 │
│                                                                                                              │
│   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                                                      │
│   │   Amazon     │  │   Amazon     │  │   Lambda     │       AI/ML SERVICES                                 │
│   │   Textract   │  │   Bedrock    │  │  (Triggers)  │       ───────────────                                 │
│   │              │  │              │  │              │                                                       │
│   │ • OCR        │  │ • Claude LLM │  │ • S3 trigger │                                                       │
│   │ • Document   │  │ • Data       │  │ • Async      │                                                       │
│   │   Analysis   │  │   Extraction │  │   processing │                                                       │
│   │              │  │ • Opinion Gen│  │              │                                                       │
│   └──────────────┘  └──────────────┘  └──────────────┘                                                      │
│                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Multi-Tenancy Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           MULTI-TENANCY MODEL                                            │
│                    (Shared Database, Shared Schema with Tenant ID)                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   TENANT LAYER                                                                           │
│   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐   ┌─────────────┐                │
│   │   BANK A    │   │   BANK B    │   │   BANK C    │   │   BANK D    │                │
│   │   (HDFC)    │   │   (ICICI)   │   │   (SBI)     │   │   (AXIS)    │                │
│   │             │   │             │   │             │   │             │                │
│   │ Users: 50   │   │ Users: 30   │   │ Users: 100  │   │ Users: 25   │                │
│   │ Requests:   │   │ Requests:   │   │ Requests:   │   │ Requests:   │                │
│   │ 500/month   │   │ 300/month   │   │ 1000/month  │   │ 200/month   │                │
│   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘   └──────┬──────┘                │
│          │                 │                 │                 │                        │
│          └─────────────────┴────────┬────────┴─────────────────┘                        │
│                                     │                                                    │
│                                     ▼                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                         TENANT RESOLUTION LAYER                                  │   │
│   │                                                                                  │   │
│   │   Request Flow:                                                                  │   │
│   │   1. User authenticates → JWT includes tenant_id claim                          │   │
│   │   2. Request arrives at API Gateway                                             │   │
│   │   3. Middleware extracts tenant_id from JWT                                     │   │
│   │   4. Sets tenant context for entire request lifecycle                           │   │
│   │   5. All queries automatically filtered by tenant_id                            │   │
│   │                                                                                  │   │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │   │
│   │   │                      TENANT CONTEXT MIDDLEWARE                           │   │   │
│   │   │                                                                          │   │   │
│   │   │   JWT Token ──► Extract tenant_id ──► Set DB Context ──► Process Request │   │   │
│   │   │                                                                          │   │   │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                     │                                                    │
│                                     ▼                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                              SHARED DATABASE                                     │   │
│   │                                                                                  │   │
│   │   ┌─────────────────────────────────────────────────────────────────────────┐   │   │
│   │   │                         PostgreSQL (RDS)                                 │   │   │
│   │   │                                                                          │   │   │
│   │   │   ┌─────────────────────────────────────────────────────────────────┐   │   │   │
│   │   │   │  Table: users                                                    │   │   │   │
│   │   │   │  ┌──────────┬──────────┬──────────┬──────────┬──────────┐       │   │   │   │
│   │   │   │  │tenant_id │ id       │ email    │ name     │ role     │       │   │   │   │
│   │   │   │  ├──────────┼──────────┼──────────┼──────────┼──────────┤       │   │   │   │
│   │   │   │  │ BANK_A   │ u001     │ a@hdfc   │ John     │ Lawyer   │       │   │   │   │
│   │   │   │  │ BANK_B   │ u002     │ b@icici  │ Jane     │ Officer  │       │   │   │   │
│   │   │   │  │ BANK_A   │ u003     │ c@hdfc   │ Mike     │ Admin    │       │   │   │   │
│   │   │   │  └──────────┴──────────┴──────────┴──────────┴──────────┘       │   │   │   │
│   │   │   │                                                                  │   │   │   │
│   │   │   │  Row Level Security (RLS) Policy:                               │   │   │   │
│   │   │   │  WHERE tenant_id = current_setting('app.current_tenant')        │   │   │   │
│   │   │   │                                                                  │   │   │   │
│   │   │   └─────────────────────────────────────────────────────────────────┘   │   │   │
│   │   │                                                                          │   │   │
│   │   └─────────────────────────────────────────────────────────────────────────┘   │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                     │                                                    │
│                                     ▼                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                           S3 DOCUMENT STORAGE                                    │   │
│   │                                                                                  │   │
│   │   legal-opinion-documents-prod/                                                 │   │
│   │   ├── BANK_A_tenant_id/                                                         │   │
│   │   │   ├── loan-requests/                                                        │   │
│   │   │   │   └── {request_id}/                                                     │   │
│   │   │   │       ├── property-docs/                                                │   │
│   │   │   │       ├── identity-docs/                                                │   │
│   │   │   │       └── financial-docs/                                               │   │
│   │   │   └── generated-opinions/                                                   │   │
│   │   ├── BANK_B_tenant_id/                                                         │   │
│   │   │   └── ...                                                                   │   │
│   │   └── BANK_C_tenant_id/                                                         │   │
│   │       └── ...                                                                   │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 5. Opinion Workflow State Machine

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          LEGAL OPINION WORKFLOW                                          │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│                                                                                          │
│   BANK OFFICER                        PANEL ADVOCATE                      SENIOR ADVOCATE│
│   ────────────                        ──────────────                      ───────────────│
│                                                                                          │
│   ┌─────────────┐                                                                        │
│   │   CREATE    │                                                                        │
│   │   REQUEST   │                                                                        │
│   └──────┬──────┘                                                                        │
│          │                                                                               │
│          │ Upload documents                                                              │
│          ▼                                                                               │
│   ┌─────────────┐                                                                        │
│   │  DOCUMENTS  │──────────── Assign to Lawyer ────────────┐                            │
│   │  UPLOADED   │                                          │                            │
│   └─────────────┘                                          │                            │
│                                                            ▼                            │
│                                              ┌─────────────────────┐                    │
│                                              │      ASSIGNED       │                    │
│                                              │   (to Advocate)     │                    │
│                                              └──────────┬──────────┘                    │
│                                                         │                               │
│                                                         │ Start Review                  │
│                                                         ▼                               │
│                                              ┌─────────────────────┐                    │
│                                              │     IN REVIEW       │                    │
│                                              │  (Docs under review)│                    │
│                                              └──────────┬──────────┘                    │
│                                                         │                               │
│                                                         │ Create Draft                  │
│                                                         ▼                               │
│                                              ╔═════════════════════╗                    │
│                                              ║       DRAFT         ║                    │
│                                              ║  (Opinion created)  ║                    │
│                                              ╚══════════╤══════════╝                    │
│                                                         │                               │
│                                                         │ Submit for Review             │
│                                                         ▼                               │
│                                              ┌─────────────────────┐                    │
│                                              │     SUBMITTED       │───────────────────►│
│                                              │ (Pending approval)  │                    │
│                                              └─────────────────────┘                    │
│                                                                                         │
│                                                                        ┌───────────────┐│
│                                                                        │  UNDER REVIEW ││
│                                                                        │(Senior reviews)│
│                                                                        └───────┬───────┘│
│                                                                                │        │
│                                              ┌─────────────────┬───────────────┼────────┤
│                                              │                 │               │        │
│                                              ▼                 ▼               ▼        │
│                                    ┌─────────────┐   ┌─────────────┐  ┌─────────────┐  │
│                                    │   REVISION  │   │  REJECTED   │  │  APPROVED   │  │
│                                    │  REQUESTED  │   │             │  │             │  │
│                                    └──────┬──────┘   └─────────────┘  └──────┬──────┘  │
│                                           │                                  │         │
│                                           │ Revise & Resubmit               │ Publish  │
│                                           │                                  ▼         │
│                                           │                          ┌─────────────┐   │
│                                           └─────────────────────────►│  PUBLISHED  │   │
│                                                                      │  (Final)    │   │
│                                                                      └──────┬──────┘   │
│                                                                             │          │
│   ◄─────────────────────────────────────────────────────────────────────────┘          │
│   Receive Final Opinion PDF                                                             │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘


   STATUS LEGEND:
   ┌─────────────┐
   │ Rectangle   │  = Normal State
   └─────────────┘
   ╔═════════════╗
   ║ Double Box  ║  = Key Milestone State  
   ╚═════════════╝
```

---

## 6. AI/LLM Processing Pipeline

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         AI/LLM DOCUMENT PROCESSING PIPELINE                              │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   PHASE 1: DOCUMENT INGESTION & OCR                                                     │
│   ──────────────────────────────────                                                    │
│                                                                                          │
│   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐      │
│   │   Document   │     │   S3 Upload  │     │   Amazon     │     │   Raw Text   │      │
│   │   Upload     │────►│   Trigger    │────►│   Textract   │────►│   Output     │      │
│   │   (PDF/IMG)  │     │   (Lambda)   │     │   (OCR)      │     │              │      │
│   └──────────────┘     └──────────────┘     └──────────────┘     └──────┬───────┘      │
│                                                                          │              │
│                                                                          ▼              │
│   PHASE 2: LLM DATA EXTRACTION                                                         │
│   ────────────────────────────                                                          │
│                                                                          │              │
│   ┌──────────────────────────────────────────────────────────────────────┼────────────┐│
│   │                          AI/LLM SERVICE                              │            ││
│   │                                                                      ▼            ││
│   │   ┌──────────────┐     ┌──────────────┐     ┌──────────────┐                     ││
│   │   │  Extraction  │     │   Amazon     │     │  Structured  │                     ││
│   │   │   Prompt     │────►│   Bedrock    │────►│    JSON      │                     ││
│   │   │  Template    │     │   (Claude)   │     │    Data      │                     ││
│   │   └──────────────┘     └──────────────┘     └──────┬───────┘                     ││
│   │                                                     │                             ││
│   │   EXTRACTED FIELDS:                                │                             ││
│   │   • Property: Address, Area, Boundaries            │                             ││
│   │   • Parties: Names, Addresses, ID Numbers          │                             ││
│   │   • Financial: Amount, Dates, Terms                │                             ││
│   │   • Legal: Registration No, EC Details             │                             ││
│   │   • Confidence Scores per field                    │                             ││
│   │                                                     │                             ││
│   └─────────────────────────────────────────────────────┼─────────────────────────────┘│
│                                                         │                              │
│                                                         ▼                              │
│   PHASE 3: DATA STORAGE & VALIDATION                   │                              │
│   ──────────────────────────────────                   │                              │
│                                                         │                              │
│   ┌──────────────┐     ┌──────────────┐     ┌──────────┴───────┐                      │
│   │  PostgreSQL  │◄────│  Validation  │◄────│  Extraction      │                      │
│   │  (Store)     │     │  & Flagging  │     │  Results         │                      │
│   └──────────────┘     └──────────────┘     └──────────────────┘                      │
│                              │                                                         │
│                              │ Low confidence?                                         │
│                              ▼                                                         │
│                        ┌──────────────┐                                               │
│                        │ Flag for     │                                               │
│                        │ Manual Review│                                               │
│                        └──────────────┘                                               │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         AI/LLM OPINION GENERATION PIPELINE                               │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   INPUTS                              PROCESSING                           OUTPUT       │
│   ──────                              ──────────                           ──────       │
│                                                                                          │
│   ┌──────────────┐                                                                      │
│   │  Extracted   │──┐                                                                   │
│   │  Document    │  │                                                                   │
│   │  Data (JSON) │  │                                                                   │
│   └──────────────┘  │                                                                   │
│                     │     ┌──────────────────────────────────────────────────────────┐  │
│   ┌──────────────┐  │     │              OPINION GENERATION SERVICE                  │  │
│   │  Opinion     │  │     │                                                          │  │
│   │  Template    │──┼────►│  ┌────────────┐    ┌────────────┐    ┌────────────┐    │  │
│   │  (Selected)  │  │     │  │  Prompt    │───►│  Amazon    │───►│  Generated │    │  │
│   └──────────────┘  │     │  │  Builder   │    │  Bedrock   │    │  Draft     │    │  │
│                     │     │  │            │    │  (Claude)  │    │            │    │  │
│   ┌──────────────┐  │     │  └────────────┘    └────────────┘    └─────┬──────┘    │  │
│   │  Loan        │  │     │                                            │           │  │
│   │  Request     │──┘     │                                            │           │  │
│   │  Details     │        │                                            │           │  │
│   └──────────────┘        └────────────────────────────────────────────┼───────────┘  │
│                                                                        │              │
│                                                                        ▼              │
│                           ┌────────────────────────────────────────────────────────┐  │
│                           │                 LAWYER REVIEW                           │  │
│                           │                                                         │  │
│                           │   ┌──────────────┐                                     │  │
│                           │   │  AI-Generated│                                     │  │
│                           │   │  Draft       │                                     │  │
│                           │   └──────┬───────┘                                     │  │
│                           │          │                                             │  │
│                           │          ▼                                             │  │
│                           │   ┌──────────────┐     ┌──────────────┐               │  │
│                           │   │   Lawyer     │────►│   Final      │               │  │
│                           │   │   Review &   │     │   Opinion    │               │  │
│                           │   │   Edit       │     │              │               │  │
│                           │   └──────────────┘     └──────────────┘               │  │
│                           │                                                         │  │
│                           │   Actions:                                             │  │
│                           │   • Accept as-is                                       │  │
│                           │   • Edit and accept                                    │  │
│                           │   • Regenerate with different parameters               │  │
│                           │   • Reject and write manually                          │  │
│                           │                                                         │  │
│                           └─────────────────────────────────────────────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              LLM PROMPT ARCHITECTURE                                     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   EXTRACTION PROMPT STRUCTURE                                                           │
│   ───────────────────────────                                                           │
│                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                  │   │
│   │   SYSTEM PROMPT:                                                                │   │
│   │   "You are a legal document analyst specializing in Indian property and        │   │
│   │    loan documents. Extract structured data accurately..."                       │   │
│   │                                                                                  │   │
│   │   USER PROMPT:                                                                  │   │
│   │   "Document Type: {doc_type}                                                    │   │
│   │    Raw Text: {ocr_output}                                                       │   │
│   │                                                                                  │   │
│   │    Extract the following fields in JSON format:                                 │   │
│   │    - property_address                                                           │   │
│   │    - property_area_sqft                                                         │   │
│   │    - seller_name                                                                │   │
│   │    - buyer_name                                                                 │   │
│   │    - sale_consideration                                                         │   │
│   │    - registration_date                                                          │   │
│   │    - registration_number                                                        │   │
│   │    - encumbrances (if any)                                                      │   │
│   │    ..."                                                                         │   │
│   │                                                                                  │   │
│   │   OUTPUT FORMAT:                                                                │   │
│   │   { "fields": [...], "confidence": {...}, "flags": [...] }                     │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
│   GENERATION PROMPT STRUCTURE                                                           │
│   ───────────────────────────                                                           │
│                                                                                          │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                                                                                  │   │
│   │   SYSTEM PROMPT:                                                                │   │
│   │   "You are an experienced legal opinion writer for bank panel advocates        │   │
│   │    in India. Generate professional legal opinions..."                           │   │
│   │                                                                                  │   │
│   │   USER PROMPT:                                                                  │   │
│   │   "Template: {opinion_template}                                                 │   │
│   │    Loan Type: {loan_type}                                                       │   │
│   │    Extracted Data: {json_data}                                                  │   │
│   │    Bank: {bank_name}                                                            │   │
│   │                                                                                  │   │
│   │    Generate a legal opinion covering:                                           │   │
│   │    1. Title verification                                                        │   │
│   │    2. Chain of ownership                                                        │   │
│   │    3. Encumbrance status                                                        │   │
│   │    4. Legal compliance                                                          │   │
│   │    5. Recommendations                                                           │   │
│   │    ..."                                                                         │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              DOCUMENT UPLOAD FLOW                                        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│                                                                                          │
│   ┌─────────┐        ┌─────────┐        ┌─────────┐        ┌─────────┐                 │
│   │         │   1    │   API   │   2    │Document │   3    │  S3     │                 │
│   │ Client  │───────►│ Gateway │───────►│ Service │───────►│ Bucket  │                 │
│   │   App   │        │         │        │         │        │         │                 │
│   └─────────┘        └─────────┘        └────┬────┘        └─────────┘                 │
│                                              │                                          │
│                                              │ 4. Publish Event                         │
│                                              ▼                                          │
│                                        ┌───────────┐                                    │
│                                        │    SQS    │                                    │
│                                        │   Queue   │                                    │
│                                        └─────┬─────┘                                    │
│                                              │                                          │
│                     ┌────────────────────────┼────────────────────────┐                 │
│                     │                        │                        │                 │
│                     ▼                        ▼                        ▼                 │
│              ┌─────────────┐          ┌─────────────┐          ┌─────────────┐         │
│              │   Virus     │          │  Thumbnail  │          │    OCR      │         │
│              │   Scanner   │          │  Generator  │          │  Processor  │         │
│              │             │          │             │          │  (Optional) │         │
│              └──────┬──────┘          └──────┬──────┘          └──────┬──────┘         │
│                     │                        │                        │                 │
│                     └────────────────────────┼────────────────────────┘                 │
│                                              │                                          │
│                                              ▼                                          │
│                                        ┌───────────┐                                    │
│                                        │  Database │                                    │
│                                        │ (Update   │                                    │
│                                        │  Status)  │                                    │
│                                        └───────────┘                                    │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           OPINION GENERATION FLOW                                        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   ┌─────────┐        ┌─────────┐        ┌─────────┐        ┌─────────┐                 │
│   │ Advocate│   1    │   API   │   2    │ Opinion │   3    │Database │                 │
│   │ (Web UI)│───────►│ Gateway │───────►│ Service │───────►│(Save)   │                 │
│   └─────────┘        └─────────┘        └────┬────┘        └─────────┘                 │
│       ▲                                      │                                          │
│       │                                      │ 4. On Publish                            │
│       │                                      ▼                                          │
│       │                              ┌───────────────┐                                  │
│       │                              │ PDF Generator │                                  │
│       │                              │               │                                  │
│       │                              │ • Apply template                                 │
│       │                              │ • Add watermark                                  │
│       │                              │ • Generate PDF                                   │
│       │                              └───────┬───────┘                                  │
│       │                                      │                                          │
│       │                                      │ 5. Store PDF                             │
│       │                                      ▼                                          │
│       │                              ┌───────────────┐                                  │
│       │                              │   S3 Bucket   │                                  │
│       │                              │ (PDFs folder) │                                  │
│       │                              └───────┬───────┘                                  │
│       │                                      │                                          │
│       │                                      │ 6. Notify                                │
│       │                                      ▼                                          │
│       │                              ┌───────────────┐      ┌───────────────┐          │
│       │                              │ Notification  │─────►│   Email/SMS   │          │
│       │                              │   Service     │      │   to Officer  │          │
│       │                              └───────────────┘      └───────────────┘          │
│       │                                                                                 │
│       │ 7. Download PDF                                                                 │
│       └─────────────────────────────────────────────────────────────────────────────────│
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Security Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              SECURITY LAYERS                                             │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   LAYER 1: PERIMETER                                                                    │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │   │
│   │  │  AWS WAF    │  │AWS Shield   │  │ CloudFront  │  │Rate Limiting│            │   │
│   │  │             │  │             │  │             │  │             │            │   │
│   │  │• SQL inject │  │• DDoS prot  │  │• Edge secur │  │• Per tenant │            │   │
│   │  │• XSS block  │  │• L3/L4 prot │  │• Geo-block  │  │• Per user   │            │   │
│   │  │• Bad bots   │  │             │  │             │  │             │            │   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                           │                                              │
│   LAYER 2: NETWORK                        ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │   │
│   │  │     VPC     │  │  Security   │  │   NACLs     │  │  Private    │            │   │
│   │  │  Isolation  │  │   Groups    │  │             │  │  Subnets    │            │   │
│   │  │             │  │             │  │             │  │             │            │   │
│   │  │• Dedicated  │  │• Stateful   │  │• Stateless  │  │• No public  │            │   │
│   │  │  VPC        │  │• Port-based │  │• Subnet lvl │  │  IP for DB  │            │   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                           │                                              │
│   LAYER 3: IDENTITY                       ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │   │
│   │  │  Cognito    │  │    MFA      │  │    JWT      │  │    RBAC     │            │   │
│   │  │  User Pool  │  │ (Required)  │  │   Tokens    │  │             │            │   │
│   │  │             │  │             │  │             │  │             │            │   │
│   │  │• User auth  │  │• TOTP app   │  │• Short exp  │  │• Roles      │            │   │
│   │  │• Password   │  │• SMS backup │  │• Refresh    │  │• Permissions│            │   │
│   │  │  policy     │  │             │  │  tokens     │  │• Tenant iso │            │   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                           │                                              │
│   LAYER 4: DATA                           ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │   │
│   │  │ Encryption  │  │  Encryption │  │   Row Level │  │   Secrets   │            │   │
│   │  │  at Rest    │  │  in Transit │  │   Security  │  │   Manager   │            │   │
│   │  │             │  │             │  │             │  │             │            │   │
│   │  │• KMS keys   │  │• TLS 1.3    │  │• Tenant     │  │• DB creds   │            │   │
│   │  │• S3 encrypt │  │• HTTPS only │  │  isolation  │  │• API keys   │            │   │
│   │  │• RDS encrypt│  │• Cert mgmt  │  │• Policy-based│ │• Rotation   │            │   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                           │                                              │
│   LAYER 5: MONITORING                     ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │   │
│   │  │ CloudTrail  │  │  GuardDuty  │  │   Audit     │  │   Alerts    │            │   │
│   │  │             │  │             │  │   Logs      │  │             │            │   │
│   │  │             │  │             │  │             │  │             │            │   │
│   │  │• API audit  │  │• Threat     │  │• App-level  │  │• Security   │            │   │
│   │  │• Compliance │  │  detection  │  │  logging    │  │  incidents  │            │   │
│   │  │• S3 logs    │  │• Anomalies  │  │• User acts  │  │• On-call    │            │   │
│   │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. CI/CD Pipeline Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              CI/CD PIPELINE (GitHub Actions)                             │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│   DEVELOPER WORKFLOW                                                                    │
│   ─────────────────                                                                     │
│                                                                                          │
│   ┌──────────┐     ┌──────────┐     ┌──────────┐                                       │
│   │Developer │────►│  Feature │────►│   Pull   │                                       │
│   │  Code    │     │  Branch  │     │  Request │                                       │
│   └──────────┘     └──────────┘     └────┬─────┘                                       │
│                                          │                                              │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                        CONTINUOUS INTEGRATION                                    │   │
│   │                                                                                  │   │
│   │   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐    │   │
│   │   │   Lint   │──►│   Test   │──►│  Build   │──►│ Security │──►│Container │    │   │
│   │   │  Check   │   │  (Unit)  │   │  Docker  │   │   Scan   │   │   Scan   │    │   │
│   │   │          │   │          │   │  Image   │   │(SonarQube)│  │ (Trivy)  │    │   │
│   │   └──────────┘   └──────────┘   └──────────┘   └──────────┘   └────┬─────┘    │   │
│   │                                                                     │          │   │
│   │                                                                     ▼          │   │
│   │                                                              ┌──────────┐      │   │
│   │                                                              │ Push to  │      │   │
│   │                                                              │   ECR    │      │   │
│   │                                                              └──────────┘      │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                              │
│                                          │ Merge to develop                             │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                       DEVELOPMENT DEPLOYMENT                                     │   │
│   │                                                                                  │   │
│   │   ┌──────────────────────────────────────────────────────────────────────────┐  │   │
│   │   │                          AUTO DEPLOY                                      │  │   │
│   │   │                                                                           │  │   │
│   │   │   Pull Image ──► Deploy to Dev EKS ──► Integration Tests ──► Notify      │  │   │
│   │   │                                                                           │  │   │
│   │   └──────────────────────────────────────────────────────────────────────────┘  │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                              │
│                                          │ Tag Release                                  │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                        STAGING DEPLOYMENT                                        │   │
│   │                                                                                  │   │
│   │   ┌──────────────────────────────────────────────────────────────────────────┐  │   │
│   │   │                       MANUAL APPROVAL                                     │  │   │
│   │   │                                                                           │  │   │
│   │   │   Approval Gate ──► Deploy to Staging ──► E2E Tests ──► QA Signoff       │  │   │
│   │   │                                                                           │  │   │
│   │   └──────────────────────────────────────────────────────────────────────────┘  │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                              │
│                                          │ Release Approval                             │
│                                          ▼                                              │
│   ┌─────────────────────────────────────────────────────────────────────────────────┐   │
│   │                       PRODUCTION DEPLOYMENT                                      │   │
│   │                                                                                  │   │
│   │   ┌──────────────────────────────────────────────────────────────────────────┐  │   │
│   │   │                    CANARY / BLUE-GREEN                                    │  │   │
│   │   │                                                                           │  │   │
│   │   │   Approval ──► Canary 10% ──► Monitor 15min ──► Canary 50% ──►Full Deploy│  │   │
│   │   │        │                            │                                     │  │   │
│   │   │        │                            │ Issues?                             │  │   │
│   │   │        │                            ▼                                     │  │   │
│   │   │        │                      Auto Rollback                               │  │   │
│   │   │                                                                           │  │   │
│   │   └──────────────────────────────────────────────────────────────────────────┘  │   │
│   │                                                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

---

*These diagrams provide visual representation of the architecture. For detailed specifications, refer to the main HLD document.*
